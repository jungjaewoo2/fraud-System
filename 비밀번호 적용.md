# Spring Boot BCrypt ë¹„ë°€ë²ˆí˜¸ ì ìš© ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ë¬¸ì œì  ë¶„ì„](#ë¬¸ì œì -ë¶„ì„)
2. [í•´ê²° ê³¼ì •](#í•´ê²°-ê³¼ì •)
3. [ì˜¬ë°”ë¥¸ BCrypt ì ìš© ë°©ë²•](#ì˜¬ë°”ë¥¸-bcrypt-ì ìš©-ë°©ë²•)
4. [ê°œë°œ ì‹œ ì£¼ì˜ì‚¬í•­](#ê°œë°œ-ì‹œ-ì£¼ì˜ì‚¬í•­)
5. [ë””ë²„ê¹… ë°©ë²•](#ë””ë²„ê¹…-ë°©ë²•)
6. [ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤](#ë² ìŠ¤íŠ¸-í”„ë™í‹°ìŠ¤)

---

## ğŸ” ë¬¸ì œì  ë¶„æ

### ë°œìƒí•œ ë¬¸ì œ
- **ì¦ìƒ**: `admin` / `123` ë¡œê·¸ì¸ ì‹œ "Bad credentials" ì˜¤ë¥˜ ë°œìƒ
- **ì›ì¸**: ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ BCrypt í•´ì‹œê°€ ì‹¤ì œ íŒ¨ìŠ¤ì›Œë“œì™€ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ
- **ë¡œê·¸**: `Failed to authenticate since password does not match stored value`

### ë¬¸ì œ ì›ì¸
```sql
-- ì˜ëª»ëœ í•´ì‹œ (ì‹¤ì œë¡œëŠ” "123"ì´ ì•„ë‹Œ ë‹¤ë¥¸ íŒ¨ìŠ¤ì›Œë“œì˜ í•´ì‹œ)
$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKTVEFDi

-- ì˜¬ë°”ë¥¸ "123" íŒ¨ìŠ¤ì›Œë“œì˜ í•´ì‹œ
$2a$10$luGYwvjsjHftusxnFJdDHegkYK.ubWP20iiB.uZ5S01Vr.QbVmB7m
```

---

## ğŸ› ï¸ í•´ê²° ê³¼ì •

### 1ë‹¨ê³„: ë””ë²„ê¹… í™˜ê²½ êµ¬ì„±
```java
// AdminService.java - íŒ¨ìŠ¤ì›Œë“œ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œ ì¶”ê°€
public void testPasswordMatching(String username, String inputPassword) {
    logger.info("=== íŒ¨ìŠ¤ì›Œë“œ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===");
    logger.info("ì…ë ¥ëœ ì‚¬ìš©ìëª…: {}", username);
    logger.info("ì…ë ¥ëœ íŒ¨ìŠ¤ì›Œë“œ: {}", inputPassword);
    
    Admin admin = findByUsername(username);
    if (admin != null) {
        logger.info("ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒëœ íŒ¨ìŠ¤ì›Œë“œ í•´ì‹œ: {}", admin.getPassword());
        
        // ì§ì ‘ BCrypt ë§¤ì¹­ í…ŒìŠ¤íŠ¸
        boolean matches = passwordEncoder.matches(inputPassword, admin.getPassword());
        logger.info("BCrypt ë§¤ì¹­ ê²°ê³¼: {}", matches);
        
        // ìƒˆë¡œìš´ í•´ì‹œ ìƒì„± í…ŒìŠ¤íŠ¸
        String newHash = passwordEncoder.encode(inputPassword);
        logger.info("ì…ë ¥ëœ íŒ¨ìŠ¤ì›Œë“œë¡œ ìƒì„±ëœ ìƒˆë¡œìš´ í•´ì‹œ: {}", newHash);
        
        // ìƒˆ í•´ì‹œì™€ ì…ë ¥ íŒ¨ìŠ¤ì›Œë“œ ë§¤ì¹­ í…ŒìŠ¤íŠ¸
        boolean newMatches = passwordEncoder.matches(inputPassword, newHash);
        logger.info("ìƒˆ í•´ì‹œì™€ ì…ë ¥ íŒ¨ìŠ¤ì›Œë“œ ë§¤ì¹­ ê²°ê³¼: {}", newMatches);
    }
    logger.info("=== íŒ¨ìŠ¤ì›Œë“œ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===");
}
```

### 2ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ì—”ë“œí¬ì¸íŠ¸ ìƒì„±
```java
// AdminController.java - í…ŒìŠ¤íŠ¸ ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
@GetMapping("/test-password")
@ResponseBody
public String testPassword() {
    adminService.testPasswordMatching("admin", "123");
    return "íŒ¨ìŠ¤ì›Œë“œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ë¡œê·¸ í™•ì¸í•˜ì„¸ìš”";
}
```

### 3ë‹¨ê³„: SecurityConfig ìˆ˜ì •
```java
// SecurityConfig.java - í…ŒìŠ¤íŠ¸ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ í—ˆìš©
.requestMatchers("/admin/test-password").permitAll()
```

### 4ë‹¨ê³„: ì˜¬ë°”ë¥¸ í•´ì‹œë¡œ êµì²´
```sql
-- data.sql - ì˜¬ë°”ë¥¸ BCrypt í•´ì‹œë¡œ ì—…ë°ì´íŠ¸
UPDATE admin SET password = '$2a$10$luGYwvjsjHftusxnFJdDHegkYK.ubWP20iiB.uZ5S01Vr.QbVmB7m', updated_at = NOW() WHERE username = 'admin';
```

---

## âœ… ì˜¬ë°”ë¥¸ BCrypt ì ìš© ë°©ë²•

### 1. PasswordEncoder Bean ì„¤ì •
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

### 2. CustomUserDetailsService êµ¬í˜„
```java
@Service
public class CustomUserDetailsService implements UserDetailsService {
    
    @Autowired
    private AdminRepository adminRepository;
    
    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        Admin admin = adminRepository.findByUsername(username)
                .orElseThrow(() -> new UsernameNotFoundException("ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + username));
        
        return new User(
                admin.getUsername(),
                admin.getPassword(), // ë°ì´í„°ë² ì´ìŠ¤ì˜ BCrypt í•´ì‹œ
                true, true, true, true,
                List.of(new SimpleGrantedAuthority("ROLE_ADMIN"))
        );
    }
}
```

### 3. ì˜¬ë°”ë¥¸ BCrypt í•´ì‹œ ìƒì„± ë°©ë²•

#### ë°©ë²• 1: ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œë¡œ ìƒì„±
```java
@Component
public class PasswordHashGenerator {
    
    @Autowired
    private PasswordEncoder passwordEncoder;
    
    public void generateHash() {
        String password = "123";
        String hash = passwordEncoder.encode(password);
        System.out.println("Password: " + password);
        System.out.println("BCrypt Hash: " + hash);
    }
}
```

#### ë°©ë²• 2: ì˜¨ë¼ì¸ BCrypt ìƒì„±ê¸° ì‚¬ìš©
- **ì¶”ì²œ ì‚¬ì´íŠ¸**: https://bcrypt-generator.com/
- **ì£¼ì˜ì‚¬í•­**: RoundsëŠ” 10-12 ì‚¬ìš© ê¶Œì¥

#### ë°©ë²• 3: í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ìƒì„±
```java
@Test
public void generateBCryptHash() {
    BCryptPasswordEncoder encoder = new BCryptPasswordEncoder();
    String password = "admin123";
    String hash = encoder.encode(password);
    
    System.out.println("Password: " + password);
    System.out.println("BCrypt Hash: " + hash);
    
    // ê²€ì¦
    assertTrue(encoder.matches(password, hash));
}
```

---

## âš ï¸ ê°œë°œ ì‹œ ì£¼ì˜ì‚¬í•­

### 1. ì´ˆê¸° ë°ì´í„° ì„¤ì •
```sql
-- âŒ ì˜ëª»ëœ ë°©ë²•: í‰ë¬¸ íŒ¨ìŠ¤ì›Œë“œ ì €ì¥
INSERT INTO admin (username, password) VALUES ('admin', '123');

-- âœ… ì˜¬ë°”ë¥¸ ë°©ë²•: BCrypt í•´ì‹œ ì €ì¥
INSERT INTO admin (username, password) VALUES ('admin', '$2a$10$ì˜¬ë°”ë¥¸BCryptí•´ì‹œ');
```

### 2. íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ ì‹œ
```java
// AdminService.java
public void changePassword(String username, String newPassword) {
    Admin admin = findByUsername(username);
    if (admin != null) {
        // âœ… ìƒˆ íŒ¨ìŠ¤ì›Œë“œë¥¼ BCryptë¡œ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥
        admin.setPassword(passwordEncoder.encode(newPassword));
        adminRepository.save(admin);
    }
}
```

### 3. ì¸ì¦ ê³¼ì •ì—ì„œ ì£¼ì˜ì‚¬í•­
```java
// âŒ ì˜ëª»ëœ ë°©ë²•: í‰ë¬¸ ë¹„êµ
if (inputPassword.equals(admin.getPassword())) {
    // ì¸ì¦ ì„±ê³µ
}

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•: BCrypt ë§¤ì¹­
if (passwordEncoder.matches(inputPassword, admin.getPassword())) {
    // ì¸ì¦ ì„±ê³µ
}
```

---

## ğŸ”§ ë””ë²„ê¹… ë°©ë²•

### 1. ë¡œê¹… ì„¤ì •
```xml
<!-- logback-spring.xml -->
<logger name="com.yourpackage.service" level="DEBUG"/>
<logger name="org.springframework.security" level="DEBUG"/>
```

### 2. íŒ¨ìŠ¤ì›Œë“œ ë§¤ì¹­ í…ŒìŠ¤íŠ¸
```java
// ë””ë²„ê¹…ìš© ë©”ì†Œë“œ
public void debugPasswordMatching(String inputPassword, String storedHash) {
    logger.info("ì…ë ¥ íŒ¨ìŠ¤ì›Œë“œ: {}", inputPassword);
    logger.info("ì €ì¥ëœ í•´ì‹œ: {}", storedHash);
    
    boolean matches = passwordEncoder.matches(inputPassword, storedHash);
    logger.info("ë§¤ì¹­ ê²°ê³¼: {}", matches);
    
    if (!matches) {
        String newHash = passwordEncoder.encode(inputPassword);
        logger.info("ì˜¬ë°”ë¥¸ í•´ì‹œ: {}", newHash);
    }
}
```

### 3. ì¼ë°˜ì ì¸ ì˜¤ë¥˜ íŒ¨í„´
```
Failed to authenticate since password does not match stored value
â†’ BCrypt í•´ì‹œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŒ

UsernameNotFoundException: ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
â†’ ì‚¬ìš©ìëª…ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì—†ìŒ

Bad credentials
â†’ íŒ¨ìŠ¤ì›Œë“œ ë¶ˆì¼ì¹˜ ë˜ëŠ” ì‚¬ìš©ì ì—†ìŒ
```

---

## ğŸ† ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 1. ê°œë°œ í™˜ê²½ ì„¤ì •
```properties
# application-dev.properties
logging.level.com.yourpackage=DEBUG
logging.level.org.springframework.security=DEBUG

# ê°œë°œìš© ê¸°ë³¸ ê³„ì • ì„¤ì •
app.admin.username=admin
app.admin.password=dev123
```

### 2. ì´ˆê¸° ë°ì´í„° ìƒì„± ì „ëµ
```java
@Component
public class DataInitializer {
    
    @Autowired
    private AdminRepository adminRepository;
    
    @Autowired
    private PasswordEncoder passwordEncoder;
    
    @PostConstruct
    public void initializeData() {
        if (!adminRepository.existsByUsername("admin")) {
            Admin admin = new Admin();
            admin.setUsername("admin");
            admin.setPassword(passwordEncoder.encode("123"));
            adminRepository.save(admin);
            
            logger.info("ê¸°ë³¸ ê´€ë¦¬ì ê³„ì • ìƒì„± ì™„ë£Œ");
        }
    }
}
```

### 3. íŒ¨ìŠ¤ì›Œë“œ ì •ì±… ì ìš©
```java
@Component
public class PasswordValidator {
    
    public boolean isValidPassword(String password) {
        return password != null 
            && password.length() >= 8
            && password.matches(".*[A-Z].*")  // ëŒ€ë¬¸ì í¬í•¨
            && password.matches(".*[a-z].*")  // ì†Œë¬¸ì í¬í•¨
            && password.matches(".*[0-9].*")  // ìˆ«ì í¬í•¨
            && password.matches(".*[!@#$%^&*()].*"); // íŠ¹ìˆ˜ë¬¸ì í¬í•¨
    }
}
```

### 4. ë³´ì•ˆ ê°•í™”
```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public PasswordEncoder passwordEncoder() {
        // BCrypt ê°•ë„ ì„¤ì • (ê¸°ë³¸ê°’: 10, ê¶Œì¥: 10-12)
        return new BCryptPasswordEncoder(12);
    }
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .sessionManagement(session -> session
                .maximumSessions(1) // ë™ì‹œ ì„¸ì…˜ ì œí•œ
                .maxSessionsPreventsLogin(false)
            )
            .rememberMe(remember -> remember
                .tokenValiditySeconds(86400) // 24ì‹œê°„
                .userDetailsService(customUserDetailsService)
            );
        
        return http.build();
    }
}
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### BCrypt ê´€ë ¨
- [Spring Security BCrypt ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-security/reference/features/authentication/password-storage.html#authentication-password-storage-bcrypt)
- [BCrypt ì˜¨ë¼ì¸ ìƒì„±ê¸°](https://bcrypt-generator.com/)
- [BCrypt ê°•ë„ ì„¤ì • ê°€ì´ë“œ](https://security.stackexchange.com/questions/17207/recommended-of-rounds-for-bcrypt)

### Spring Security ê´€ë ¨
- [Spring Security ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-security/reference/index.html)
- [UserDetailsService êµ¬í˜„ ê°€ì´ë“œ](https://docs.spring.io/spring-security/reference/servlet/authentication/passwords/user-details-service.html)

---

## ğŸ¯ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê°œë°œ ì‹œì‘ ì „
- [ ] PasswordEncoder Bean ì„¤ì • í™•ì¸
- [ ] CustomUserDetailsService êµ¬í˜„
- [ ] ì´ˆê¸° ê´€ë¦¬ì ê³„ì • BCrypt í•´ì‹œ ìƒì„±
- [ ] SecurityConfig ì„¤ì • í™•ì¸

### ê°œë°œ ì¤‘
- [ ] íŒ¨ìŠ¤ì›Œë“œ ì €ì¥ ì‹œ BCrypt ì•”í˜¸í™” ì ìš©
- [ ] íŒ¨ìŠ¤ì›Œë“œ ë¹„êµ ì‹œ matches() ë©”ì†Œë“œ ì‚¬ìš©
- [ ] ë¡œê¹… ì„¤ì •ìœ¼ë¡œ ë””ë²„ê¹… í™˜ê²½ êµ¬ì¶•

### ë°°í¬ ì „
- [ ] ê¸°ë³¸ íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½
- [ ] íŒ¨ìŠ¤ì›Œë“œ ì •ì±… ì ìš©
- [ ] ë³´ì•ˆ ì„¤ì • ì ê²€
- [ ] ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

**ì‘ì„±ì¼**: 2025-09-14  
**í”„ë¡œì íŠ¸**: ìƒí’ˆê¶Œ ë¶€ì •ë°©ì§€ ì‹œìŠ¤í…œ  
**ì‘ì„±ì**: AI Assistant
